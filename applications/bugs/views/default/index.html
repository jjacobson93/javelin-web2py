{{extend 'layout.html'}}

{{block content}}
<div class="row-fluid">
	<h1 class="pull-left">Javelin Bug Center <i class="icon-bug"></i></h1>
	<a class="btn pull-right" href="{{=URL('default', 'new_ticket')}}" style="margin: 15px 0;"><i class="icon-ticket"></i>New Ticket</a>
</div>
<ul class="nav nav-pills">
	<li class="active"><a href="#submitted" data-toggle="tab">Your Tickets</a></li>
	{{if auth.has_membership('admin'):}}
	<li><a href="#all" data-toggle="tab">All Tickets</a></li>
	{{pass}}
</ul>
<div class="tab-content">
	<div class="tab-pane active fade in" id="submitted">
		{{if submissions:}}
		<table class="table table-striped">
			<thead>
				<tr>
					<th>Ticket ID</th>
					<th>Description</th>
					<th>Type</th>
					<th>Created On</th>
					<th>Approved?</th>
					<th>Fixed?</th>
				</tr>
			</thead>
			<tbody>
				{{for s in submissions:}}
				<tr>
					<td>{{=s.id}}</td>
					<td>{{=s.description}}</td>
					<td>{{=s.type}}</td>
					<td>{{=s.created_on}}</td>
					<td>{{='Yes' if s.approved else 'No'}}</td>
					<td>{{='Yes' if s.fixed else 'No'}}</td>
				</tr>
				{{pass}}
			</tbody>
		</table>
		{{else:}}
		<div class="alert alert-info">No Tickets</div>
		{{pass}}
	</div>
	{{if auth.has_membership('admin'):}}
	<div class="tab-pane fade in" id="all">
		{{if all_tickets:}}
		<table class="table table-striped">
			<thead>
				<tr>
					<th>Ticket ID</th>
					<th>Description</th>
					<th>Type</th>
					<th>Created On</th>
					<th>User</th>
					<th>Approved?</th>
					<th>Fixed?</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				{{for s in submissions:}}
				<tr>
					<td>{{=s.id}}</td>
					<td>{{=s.description}}</td>
					<td>{{=s.type}}</td>
					<td>{{=s.created_on}}</td>
					<td>{{=db(db.auth_user.id==s.user_id).select().first().username}}</td>
					<td>{{='Yes' if s.approved else 'No'}}</td>
					<td>{{='Yes' if s.fixed else 'No'}}</td>
					<td>
						<a href="{{=URL(a='bugs', c='default', f='ticket', vars={'id': str(s.id)})}}" class="btn">View</a>
						{{if not s.approved:}}
						<a href="javascript:approveTicket({{=s.id}})" class="btn btn-success">Approve</a>
						<a href="javascript:disapproveTicket({{=s.id}})" class="btn btn-danger">Disapprove</a>
						{{else:}}
						<a href="javascript:markFixed({{=s.id}})" class="btn btn-primary">Mark Fixed</a>
						{{pass}}
					</td>
				</tr>
				{{pass}}
			</tbody>
		</table>
		{{else:}}
		<div class="alert alert-info">No Tickets</div>
		{{pass}}
	</div>
	{{pass}}
</div>
{{end}}