{{extend 'layout.html'}}

{{block content}}
<div class="row-fluid">
	<h1 class="pull-left">Peer Support <i class="icon-heart"></i></h1>
	<a class="btn btn-large btn-danger pull-right btn-long" href="{{=URL('peersupport', 'new_issue')}}" style="margin: 8px 0;">
		<i class="icon-warning-sign"></i>New Issue
	</a>
</div>
<ul class="nav nav-pills">
	<li class="active"><a href="#issues" data-toggle="tab">All Issues</a></li>
</ul>

<div class="tab-content">
	<div class="tab-pane active fade in" id="submitted">
		{{if issues:}}
		<table class="table table-striped sortable table-mobile">
			<thead>
				<tr>
					<th>Issue ID</th>
					<th>Date Created</th>
					<th>Date Updated</th>
					<th>Crew #</th>
					<th>Room #</th>
					<th>Student Name</th>
					<th>Peer Support Student</th>
					<th>Need Follow Up?</th>
					<th>Refer to PS?</th>
					<th>Actions</th>
				</tr>
			</thead>
			<tbody>
				{{for i in issues:}}
				<tr>
					<td>{{=i.student_issue.id}}</td>
					<td>{{=i.student_issue.timestamp}}</td>
					<td>{{=i.student_issue.updated}}</td>
					<td>{{=i.crew.id}}</td>
					<td>{{=i.crew.room if i.crew.room else 'None'}}</td>
					<td>{{=' '.join([i.student.first_name, i.student.last_name])}}</td>
					<td>{{=' '.join([i.peer_support.first_name, i.peer_support.last_name])}}</td>
					<td>{{='Yes' if i.student_issue.need_follow_up else 'No'}}</td>
					<td>{{='Yes' if i.student_issue.refer else 'No'}}</td>
					<td>
						<a href="{{=URL(a='javelin', c='peersupport', f='issue', vars={'id': str(i.student_issue.id)})}}" class="btn mobile-btn"><i class="icon-eye-open"></i>View</a>
						<a href="{{=URL(a='javelin', c='peersupport', f='follow_up', vars={'id': str(i.student_issue.id)})}}" class="btn btn-primary"><i class="icon-refresh"></i>Follow Up</a>
					</td>
				</tr>
				{{pass}}
			</tbody>
		</table>
		{{else:}}
		<div class="alert alert-info" style="padding-top: 20px; padding-bottom: 20px"><h4>No Issues</h4></div>
		{{pass}}
	</div>
</div>
{{end}}